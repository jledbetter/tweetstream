<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                template="/templates/iPadTemplate.xhtml">

   <ui:define name="metadata">
      <f:metadata>
         <f:event type="preRenderView" listener="#{twitterAgent.updateTweets}"/>
      </f:metadata>
   </ui:define>

   <ui:define name="head">
      <title>TweetStream Tablet</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

      <!-- enable full-screen mode -->
      <meta name="apple-mobile-web-app-capable" content="yes"/>
      <!-- controls the appearance of the status bar in full-screen mode -->
      <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

      <script type="text/javascript">
         //TODO - create global .js to be used only for mobile devices
         function hideURLbar()
         {
            setTimeout(scrollTo, 0, 0, 1);
         }


         //Take a JSON version of the twitterAggregate object
         // and update the UI's below with the new values
         function refreshTweets(twAggStr){

            var twAgg = JSON.parse(twAggStr);

            //Clear and then update tweets
            var list = document.getElementById('list').innerHTML = '';

            var tweets = twAgg.tweets;

             alert("4 - " + tweets.length);

             for(var i in tweets)
            {
                alert(i);
               var tweet = tweets[i];

               li = document.createElement ("li");
               li.appendChild (document.createTextNode (tweet[text]));
               list.appendChild (li);


               //document.getElementById('tweetstreamOutput').innerHTML += tweet.text;
               //var tweetcontainer = document.createElement("div");
               //tweetcontainer.innerHTML = tweet.text;
               //tweetcontainer.style.border = '1px solid black';
               //document.getElementById('tweet-list').appendChild(tweetcontainer);
            }


         }
      </script>
      <h:outputStylesheet name="css/ipad.css"/>

   </ui:define>

   <ui:define name="body">
      <h:form>
          <a4j:jsFunction name="updateContent" action="#{twitterAgent.updateTweets}"
                          render="browser_form"/>
         <!-- TODO temp polling server for updates - replace with push -->
          <a4j:push address="aggregate@twitter"
                   onerror="alert('Error retrieving pushed data')"
                   ondataavailable="updateContent()">
         </a4j:push>
      </h:form>
      <h:form id="browser_form">
         <div id="browser">
            <div id="header" class="header-gradient">
               <h1>TweetStream Tablet</h1>
            </div>

            <div id="stream" class="landscape-leftbar">
               <rich:panel>
                  <ul id="list">
                     <ui:repeat value="#{twitterAgent.tweets}" var="tweet">
                        <li id="listRowTemplate" class="listRowTemplate_template first" style=""
                            onclick="itemClicked(event)">
                           <div class="rowTitle_template" id="rowTitle">#{tweet.text}...</div>
                           <div id="rowArrow" class="rowArrow_template"></div>
                        </li>
                     </ui:repeat>
                  </ul>
               </rich:panel>
            </div>

            <div id="top_tags" class="landscape-rightbar">
               <rich:panel header="Top Tags">
                  <ul id="top_tags_list">
                     <ui:repeat value="#{twitterAgent.hashtags}" var="tag">
                        <li id="top_tags_listRowTemplate" class="listRowTemplate_template first" style=""
                            onclick="itemClicked(event)">
                           <div class="rowTitle_template"
                                id="top_tags_rowTitle">#{tag.hashtag} -- count #{tag.count}...
                           </div>
                           <div id="top_tags_rowArrow" class="rowArrow_template"></div>
                        </li>
                     </ui:repeat>
                  </ul>
               </rich:panel>
            </div>

            <div id="top_tweeters" class="landscape-rightbar">
               <rich:panel header="Top Tweeters">
                  <ul id="top_tweeters_list">
                     <ui:repeat value="#{twitterAgent.tweeters}" var="tweeter">
                        <li id="top_tweeters_listRowTemplate" class="listRowTemplate_template first" style=""
                            onclick="itemClicked(event)">
                           <div class="rowTitle_template"
                                id="top_tweeters_rowTitle">#{tweeter.user} -- count #{tweeter.tweetCount}...
                           </div>
                           <div id="top_tweeters_rowArrow" class="rowArrow_template"></div>
                        </li>
                     </ui:repeat>
                  </ul>
               </rich:panel>

            </div>
         </div>
      </h:form>
   </ui:define>

</ui:composition>