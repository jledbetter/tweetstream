<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                template="/templates/iPhoneTemplate.xhtml">

<ui:define name="metadata">
   <f:metadata>
      <f:event type="preRenderView" listener="#{twitterAgent.updateTweets}"/>
   </f:metadata>
</ui:define>

<ui:define name="head">
<style type="text/css">
/*Global*/
body {
   background-image: url(#{request.contextPath}/resources/images/iphone/backgroundStripes.png);
   background-repeat: repeat;
   margin: 0;
   padding: 0;
   min-height: 416px;
   font: 80% / 1.5em "Helvetica", "Lucida Sans", Verdana, Arial, sans-serif;
}

a {
   text-decoration: none;
}

#browser {
   height: auto;
   -webkit-margin-top-collapse: separate;
   -webkit-margin-bottom-collapse: separate;
   position: relative;
   min-height: 416px;
   width: auto;
}

#header {
   position: relative;
   height: 44px;
   width: auto;
   font-weight: bold;
   color: #fff;
   text-shadow: rgba(0, 0, 0, 0.6) 0px -1px 0px;
   font-size: 16pt;
   border: 0;
   text-align: center;
   line-height: 47px;
   -webkit-user-select: none;
}

#page-container {
   position: relative;
   left: 0px;
   top: 0px;
   min-height: 20px;
   width: auto;
   height: auto;
   overflow: hidden;
   z-index: 0;
   min-height: 372px;
}



.list {
   overflow: hidden;
   padding: 0px;
   margin: 0px;
   height: auto;
   position: relative;
   width: auto;
   cursor: default;
   -webkit-user-select: none;
}


.detail-box {
   padding: 8px;
   border: 1px solid rgb(172, 172, 172);
   background-color: white;
   -webkit-border-radius: 8px 8px;
   position: relative;
   margin: 10px 9px 12px 9px;
   -webkit-margin-top-collapse: separate;
   -webkit-margin-bottom-collapse: separate;
   width: auto;
   min-height: 64px;
   height: auto;
}

.detail-title {
   color: black;
   text-overflow: ellipsis;
   overflow: hidden;
   font-size: 16pt;
   font-weight: bold;
   text-align: left;
}

.detail-subtitle {
   color: rgb(128, 128, 128);
   font-size: 12px;
   margin-top: 2px;
   min-height: 17px;
   white-space: nowrap;
}

.detail-description {
   color: black;
   font-size: 13px;
   text-overflow: ellipsis;
   overflow: hidden;
   position: absolute;
   top: 7px;
   left: 63px;
}


.tweet-box {
   padding: 1px 3px 5px 7px;
   border: 1px solid rgb(172, 172, 172);
   background-color: white;
   -webkit-border-radius: 8px 8px;
   position: relative;
   margin: 7px 9px 1px 9px;
   -webkit-margin-top-collapse: separate;
   -webkit-margin-bottom-collapse: separate;
   width: auto;
   min-height: 64px;
   height: auto;
}

.tweet-image {
   color: black;
   overflow: hidden;
   font-size: 16pt;
   font-weight: bold;
   text-align: left;
   width:48px;
   float: left;
}

.tweet-username {
   color: rgb(128, 128, 128);
   font-size: 12px;
   margin-top: 2px;
   min-height: 17px;
   white-space: nowrap;
   float: left;
   width: auto;
}

.tweet-description {
   color: black;
   font-size: 13px;
   text-overflow: ellipsis;
   overflow: hidden;
   float: right;
   width: auto;
}

.tweet-description img {
   padding: 1px 7px 0 0;
}



/*Buttons and bars*/
.back_button {
   font-weight: bold;
   font-size: 12px;
   color: #fff;
   text-shadow: rgba(0, 0, 0, 0.6) 0px -1px 0px;
   text-align: center;
   text-overflow: ellipsis;
   height: 30px;
   width: 60px;
   position: absolute;
   top: 7px;
   left: 5px;
   line-height: 30px;
}

.agenda_button {
   font-weight: bold;
   font-size: 12px;
   color: #fff;
   text-shadow: rgba(0, 0, 0, 0.6) 0px -1px 0px;
   text-align: center;
   text-overflow: ellipsis;
   height: 30px;
   width: 60px;
   position: absolute;
   top: 7px;
   right: 5px;
   line-height: 30px;
}

.button {
   background: #af7124 -moz-linear-gradient(90deg, rgba(0, 0, 0, .3) 33%, rgba(255, 255, 255, .1) 123%);
   background: #af7124 -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, .1)), to(rgba(0, 0, 0, .3)));
   border-radius: 7px;
   mozborder-radius: 7px;
   webkitborder-radius: 7px;
   border: none;
}

.header-gradient {
   background: #5889a0 -moz-linear-gradient(90deg, rgba(0, 0, 0, .3) 33%, rgba(255, 255, 255, .1) 123%);
   background: #5889a0 -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, .1)), to(rgba(0, 0, 0, .3)));
   border: none;
}

.summit-button {
   background: #af7124 -moz-linear-gradient(90deg, rgba(0, 0, 0, .3) 33%, rgba(255, 255, 255, .1) 123%);
   background: #af7124 -webkit-gradient(linear, left top, left bottom, from(#cd3333), to(#992828));
   border-radius: 7px;
   mozborder-radius: 7px;
   webkitborder-radius: 7px;
   border: none;
}

.summit-header-gradient {
   background: #5889a0 -moz-linear-gradient(90deg, rgba(0, 0, 0, .3) 33%, rgba(255, 255, 255, .1) 123%);
   background: #5889a0 -webkit-gradient(linear, left top, left bottom, from(#717172), to(#0f0f10), color-stop(0.5, #3a3a3a), color-stop(0.5, #0d0d0f));
   border: none;
}

.nav-button {
   font-family: "Helvetica Neue", Helvetica, sans-serif;
   font-size: 0.8em;
   font-weight: bold;
   padding: 0 5px 0 5px;
   height: 24px;
   border: 1px solid #4c525a;
   background: -webkit-gradient( linear, left top, left bottom, from(#9fafc1), to(#6c83a1), color-stop(0.5, #798eaa), color-stop(0.5, #6c83a1) );
   margin: 0;
   text-shadow: 0px 1px 0 #000;
   -webkit-background-origin: padding-box;
   -webkit-background-clip: border-box;
   -webkit-border-radius: 8px;
   line-height: 23px;
   color: #fff;
}

.nav-button-left {
   -webkit-border-bottom-left-radius:8px;
   -webkit-border-top-left-radius: 8px;
   -webkit-border-bottom-right-radius: 0;
   -webkit-border-top-right-radius: 0;
   width:45%;
   float:left;
   margin: 0;
   border-width: 1px 1px 1px 1px;

}

.nav-button-right {
   -webkit-border-bottom-left-radius: 0;
   -webkit-border-top-left-radius: 0;
   -webkit-border-bottom-right-radius: 8px;
   -webkit-border-top-right-radius: 8px;
   width: 45%;
   float:left;
   margin: 0;
   border-width: 1px 1px 1px 0;
}

#nav-button-container {
   width: 80%;
   margin: 5px auto 0 auto;
   text-align: center;
}

.nav-button:hover, nav-button:active {
   color: #fff;
   text-shadow: none;
}


/*utils - functions */
.hide {
   opacity: 0;
}

.hide-delay {
   opacity: 0;
   -webkit-transition-delay: 0.3s;
}

.show {
   opacity: 1;
}

.show-delay {
   opacity: 1;
   -webkit-transition-delay: 0.3s;
}

.none {
   display: none;
}

.block {
   display: block;
}

.stage-center {
   top: 0;
   left: 0;
   width: 100%;
}

.transition {
   -moz-transition-duration: 1.5s;
   -webkit-transition-duration: 1.5s;
   -o-transition-duration: 1.5s;
}



/*client specific styles*/
#tweet-detail {
   position: absolute;

}

#tweet-detail a {
   text-decoration: none;

}

/*iphone landscape screen width*/
@media screen and (min-device-width: 321px) {
   .stage-left {
      left: -480px;
      opacity: 0;
   }

   .stage-right {
      opacity: 0;
      left: 480px;
   }
}

/*iphone portrait screen width*/
@media screen and (max-device-width: 320px) {
   .stage-left {
      left: -320px;
      opacity: 0;
   }

   .stage-right {
      opacity: 0;
      left: 320px;
   }
}

/*catch all for larger than iphone landscape device widths*/
@media screen and (min-device-width: 481px) {
   .stage-left {
      left: -1024px;
      opacity: 0;
   }

   .stage-right {
      opacity: 0;
      left: 1024px;
   }
}



/*flip transition related*/
.flip-face {
   position: relative;
   width: 100%;
   -webkit-transition-property: -webkit-transform, background;
   -webkit-transition-duration: 1s, 0;
   -webkit-transform-style: preserve-3d;
   -webkit-transition-delay: 0, 0.3s;
   overflow: hidden;
   -webkit-transform: rotateY(0deg);

}

.flip-back {
   -webkit-transform: rotateY(180deg);
   width: 100%;
}


#agenda {
   width: 100%;
   height: 100%;
   -webkit-user-select: element;
   -webkit-transform: rotateY(180deg);
}

.agenda-flip-show {
   position: absolute;
   top: 44px;
   left: 0;
}

#top-hashtags {
   position: absolute;
}

#top-tweeters {
   position: absolute;
}

/*// should technically achieve a similar result to the above query,*/
/*// targeting based on screen resolution (the iPhone 4 has 326 ppi/dpi)*/
/*@media only screen and (min-resolution: 300dpi) {*/
/*// CSS goes here*/
/*}*/
</style>
<script type="text/javascript">

   function showDetail(e)
   {
      //change the class name so we get the css transition for old and new page
      swap('back-button','button back_button show transition');
      swap('home-page','iphone-page stage-left transition');
      swap('tweet-detail','stage-center transition');
      hideURLbar();
   }

   function hideDetail(e)
   {
      //change the class name so we get the css transition for old and new page
      swap('back-button','button back_button hide transition');
      swap('home-page','iphone-page stage-center transition');
      swap('tweet-detail','stage-right transition hide');
   }

   function flip(e)
   {
      //change the class name so we get the css transition for old and new page
      swap('flippable','flip-face flip-back');
      swap('agenda','agenda-flip-show show-delay');
      swap('home-page','hide-delay');

      //hide tweet detail if coming from that screen
      swap('tweet-detail','none');
      //change the button
      swap('agenda-back-button','button agenda_button');
      swap('agenda-button','none');
      swap('back-button','button back_button hide');
   }

    function flipBack()
   {
      swap('flippable','flip-face');
      swap('agenda','hide-delay');
      swap('home-page','list stage-center transition');
      swap('agenda-back-button','none');
      swap('agenda-button','button agenda_button');
   }

   function showTweeters() {
      swap('tweeters-back-button','button back_button show transition');
      swap('home-page','iphone-page stage-left transition');
      swap('top-tweeters','stage-center transition');
   }

   function hideTweeters() {
      swap('tweeters-back-button','hide');
      swap('home-page','iphone-page stage-center transition');
      swap('top-tweeters','stage-right transition hide');
   }

   function showHashtags() {
      swap('tags-back-button','button back_button show transition');
      swap('home-page','iphone-page stage-left transition');
      swap('top-hashtags','stage-center transition');

   }

   function hideHashtags() {
      swap('tags-back-button','hide');
      swap('home-page','iphone-page stage-center transition');
      swap('top-hashtags','stage-right transition hide');
   }





   function swap(id,classString) {
      //var element = document.getElementById(id);
      //classString = element.className + ' ' + classString;
      document.getElementById(id).className = classString;
   }

   function jumpToTop(){
      window.location = window.location + "#browser";
   }
</script>
<ui:insert name="head"/>
</ui:define>
<ui:define name="body">

   <div id="browser">
      <div id="header" class="summit-header-gradient">
         TweetStream
         <div id="back-button" class="summit-button back_button hide" onclick="hideDetail()">Back</div>
         <div id="tweeters-back-button" class="hide" onclick="hideTweeters()">Back</div>
         <div id="tags-back-button" class="hide" onclick="hideHashtags()">Back</div>
         <div id="agenda-button" class="summit-button agenda_button" onclick="flip()">About</div>
         <div id="agenda-back-button" class="hide" onclick="flipBack()">Back</div>
      </div>
      <div id="flippable" class="flip-face">

         <div id="page-container">

            <!--TODO - conditional rendering-->

            <div class="iphone-page" id="home-page">

               <div id="nav-button-container">
                    <div class="nav-button nav-button-left" onclick="showTweeters()">Top Tweeters</div>
                    <div class="nav-button nav-button-right" onclick="showHashtags()">Top Hashtags</div>
                    <br clear="all"/>
                </div>

               <h:form id="list-form">
                 <ul id="tweet-list" class="list">
                    <ui:repeat value="#{twitterAgent.tweets}" var="tweet">
                       <li id="list-row-#{tweet.id}" class="" tabindex="-1">
                          <a4j:commandLink action="#{twitterAgent.setSelectedTweet(tweet)}" oncomplete="showDetail()">
                             <div class="tweet-box">
                                <span class="tweet-username">#{tweet.screenName}</span>
                                <div class="tweet-description"><img src="#{tweet.profileImageUrl}" alt="" align="left"/>#{tweet.text}</div>
                                <br clear="all"/>
                             </div>
                          </a4j:commandLink>
                       </li>
                    </ui:repeat>
                 </ul>
              </h:form>

           </div>



              <div class="iphone-page">
                 <div id="tweet-detail" class="stage-right">
                  <a4j:outputPanel id="list-panel" ajaxRendered="true">
                     <div class="tweet-box">
                        <span class="tweet-username">#{twitterAgent.selectedTweet.screenName}</span>
                        <div class="tweet-description"><img src="#{twitterAgent.selectedTweet.profileImageUrl}" alt="" align="left"/>#{twitterAgent.selectedTweet.text}</div>
                        <br clear="all"/>
                     </div>
                  </a4j:outputPanel>
                 </div>
              </div>

              <div class="iphone-page">
                 <div id="top-tweeters" class="stage-right hide">
                    <div id="tweeters-container" class="">
                     Top tweeters

                    <ul>
                      <ui:repeat value="#{twitterAgent.tweeters}" var="tweeter">
                        <li>
                          <div>
                            <img src="#{tweeter.profileImgUrl}" alt="ttw_img" class=""/>

                            <div class="">
                              <h:outputText value="#{tweeter.user}" class=""/>
                              <h:outputText value="#{tweeter.tweetCount}" class=""/>
                            </div>
                          </div>
                        </li>
                      </ui:repeat>
                    </ul>

                    </div>
                 </div>
              </div>

               <div class="iphone-page">
                 <div id="top-hashtags" class="stage-right hide">
                    <div id="hashtags-container" class="">
                    Top hashtags

                    <ul>
                      <ui:repeat value="#{twitterAgent.hashtags}" var="tag">
                        <li>
                          <div class="">
                            <h:outputText value=" ##{tag.hashtag}" class=""/>
                            <h:outputText value="#{tag.count}" class=""/>
                          </div>
                        </li>
                      </ui:repeat>
                    </ul>

                    </div>
                 </div>
              </div>




              <div class="iphone-page">

                 <div id="agenda" class="hide">
                  <img src="#{request.contextPath}/resources/images/judcon-logo.gif" alt=""/>
                    About this project or the conference....
                 </div>

              </div>


         </div>


      </div>


   </div>
</ui:define>

</ui:composition>